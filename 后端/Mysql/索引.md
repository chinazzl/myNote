## Mysql索引

### 索引原理

- 把创建好的索引数据内容进行排序
- 对排序结果生成倒排表
- 在倒排表上拼上数据地址链
- 在查询的时候，先拿到倒排表的内容，再取出地址链，从而拿到数据

### 索引类型

1. 数据结构维度
   - B+ Tree索引
   - Hash索引
   - 全文索引
   - R- Tree索引
2. 物理存储维度
   - 聚簇索引
   - 非聚簇索引
3. 逻辑维度
   - 主键索引
   - 普通索引
   - 联合索引
   - 唯一索引
   - 空间索引

### 索引设计的原则

- 适合索引的列是在where子句中的列，或者连接子句中指定的列
- 基数较小的类，索引效果较差，没必要在此列建立索引
- 使用短索引，如果对长字符串进行索引，应该指定一个前缀长度，这样能够节省大量索引空间

### 创建索引的原则

1. 左前缀匹配原则，组合索引非常重要的原则，mysql会一直向右匹配直到遇到范围查询(>、<、
   between、like)就停止匹配，比如a=1andb=2andc>3andd=4如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立 (a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。  
2. 较为频繁作为查询条件的字段才去创建索引
3. 更新频繁的字段不适合创作索引
4. 尽量扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可。

#### 创建索引的方式

1. CREATETABLE的时候创建索引

2. 使用alter table 进行增加索引
   
   ```sql
   -- table_name 表名
   -- colume_list 哪些列进行索引
   -- index_name 可以自己命名
   alter table table_name add index index_name(colume_list)
   ```

3. 使用create index命令创建
   
   ```sql
   create index index_name on table_name(column_list)
   ```

#### 删除索引

```sql
alter table user_index drop key name;
alter table user_index drop key id_card;
alter table user_index drop key information;
```

### 索引实现算法

1. B Tree算法
   - B Tree ：B Tree是常用的Mysql数据库索引算法，也是mysql默认的算法。因为它不仅可以被用在=,>,>=,<,<=和between这些比较操作符上，而且还可以用于like操作符，只要它的查询条件是一个不以通配符开头的常量  
     - 使用B Tree好处：B树可以在内部节点同时存储键和值，因此，把频繁访问的数据放在靠近根节点的地方将会大大提高热点数据的查询效率。这种特性使得B树在特定数据重复多次查询的场景中更加高效。
     - 使用B+ Tree好处：由于B+树的内部节点只存放键，不存放值，因此，一次读取，可以在内存页中获取更多的键，有利于更快地缩小查找范围。B+树的叶节点由一条链相连，因此，当需要进行一次全数据遍历的时候，B+树只需要使用O(logN)时间找到最小的一个节点，然后通过链进行O(N)的顺序遍历即可。而B树则需要对树的每一层进行遍历，这会需要更多的内存置换次数，因此也就需要花费更多的时间  
2. Hash算法：Hash索引只能用于对等比较，例如=,<=>（相当于=）操作符。由于是一次定位数据，不像B Tree索引需要从根节点到枝节点，后才能访问到页节点这样多次IO访问，所以检索效率远高于B Tree索引。  

### Mysql的索引实现

1. Myisam 的索引实现：B+ Tree 每一个节点会存储数据记录的地址值，首先按照B+ Tree搜索算法搜索索引，如果指定key存在，则取出其data域的值，然后以data域的值为地址，读取相应数据记录。
2. InnoDB 的索引实现：InnoDB没有索引文件，表数据文件本身就是按照B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。