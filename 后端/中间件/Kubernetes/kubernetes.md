# Kubenetes 

## 概念
1. Node：类似物理机或虚拟机
2. pod：k8s最小调度单元，容器的抽象
3. Service：暴露统一入口访问多个pod集群，当一个pod挂掉后，即使k8s重新分配ip，service也不会受到影响。同时也分为外部服务和内部服务，内部服务是对内提供的服务，是不想暴露给外部的服务例如数据库、缓存等中间件。外部服务是暴露给外部的服务例如api接口、web页面。外部服务有几种常用类型，一种就是nodeport，在节点开放一个端口，将这个端口访问外部服务。
4. Ingress：管理从集群外部访问集群内部的入口和方式 ，可以配置Ingress配置不同的访问方式和规则，例如通过Ingress将IP访问改变为域名访问
5. ConfigMap：将配置文件配置到其中，在不进行充气服务的时候修改配置就能生效，保证可移植性，但是配置是明文的
6. Volume：数据持久化存储 
7. Deployment：设置集群的副本数量以及应用程序的更新策略，简化应用的部署和更新。pod集群的抽象
8. StatefulSet：对于有状态的pod进行管理同步和副本

## Kubernetes架构
1. workNode:工作节点，应用pod部署的节点，真正干活的节点，每个Node包含
   1. kubelet：负责管理和维护每个pod，并确保它们按照预期运行。定期从api-server接收新的活着修改后的pod规范。同时也会监控工作节点的运行情况。然后将这些信息汇报给apiserer
   2. kubeProxy：为pod对象提供网络代理和负载均衡服务。通常一个k8s集群会有多个节点，需要一个负载均衡器从service中获取请求，然后将勤求发送到不同的节点上完成负载均衡的功能。k-proxy就是在每个Node上启动一个网络代理，使法网service的流量以一种高效的方式路由到正确的后端pod中。例如app要访问数据库，并不是随机路由到任意一个节点上，而会路由到和app同一个pod的数据库中
   3. containerRuntime：一个运行容器的软件，负责创建容器、拉取容器镜像、启动活着停止容器。类似dockerEngine、Containerd
2. masterNode：
   1. kube-openserver：负责童工Kubernetes集群的api接口服务，所有的组建都会通过这个接口来进行通信
   2. etcd：高可用的键-值存储系统，存储整个集群的状态
   3. ControllerManager：负责管理集群中各种资源对象的状态，如果集群中任何一个节点上的pod发生故障的时候，要有一种机制来监控和检测到这个故障。然后尽可能快地对这个故障进行处理。重启或者替换新的pod
   4. Scheduler：调度器。负责监控及群众所有节点的资源使用情况 ，根据一些调度策略将POD调度到合适的节点上运行。如果三个节点，a占用80%，b占用20%，c占用40%，它会自动分配到资源占用少的节点