## Alibaba-Sentinel

#### 流控模式

1. 直接：统计当前资源的请求，触发阈值时对当前资源进行直接限流，也是默认的模式

2. 关联：统计与当前资源相关的另一个资源，触发阈值时，对当前资源限流。（/read资源与/write资源进行关联，会监听/write资源的使用状态，当关联资源/write触发阈值时，对统计资源/read进行限流。）
   
   **适用：**
   
   - 两个有竞争关系的资源
   
   - 一个优先级较高，一个优先级较低。

3. 链路：统计从指定链路访问到本资源的请求，触发阈值时，对指定链路限流。

#### 流控效果

1. 快速失败：当超过设定阈值，则直接抛出异常

2. Warmup：根据最大阈值/3，计算出流量最初时期的QPS阈值，后面逐渐增大阈值直到最大设定阈值。

3. 排队等待：是让所有请求进入一个队列中，然后按照阈值允许的时间间隔一次执行。后来的请求必须等待前面执行完成，如果请求预期的等待时间超出最大时长，则会拒绝抛出异常。

#### 热点参数限流

分别统计**参数值相同**的请求，判断是否超过QPS阈值。

#### 线程池隔离：

1. 基于信号量：轻量化，无额外开销

2. 基于线程池：可以自主独立控制响应时长，支持异步调用。但是额外开销较大

#### 熔断降级

熔断降级时解决雪崩问题的重要手段你。其思路时由**断路器**统计服务调用的比例、慢请求比例，如果超出阈值则会熔断该服务。即拦截访问该服务的一切请求；而当服务恢复时，断路器会放行访问该服务的请求。

```plantuml
hide footbox
title 熔断降级
Closed-> Open: 达到失败阈值
Closed--> Closed: success
Open --> Open: 快速失败
Open --> "Half-Open": 熔断时间结束
"Half-Open" -> "Half-Open": 尝试放行一次请求
"Half-Open" --> Open: fail打开断路器
"Half-Open" ---> Closed: 关闭断路器success
```
